name: Rust Publish on Release

on:
    push:
        branches:
            - "release"

jobs:
    build-and-publish:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v3

            - name: Set up Rust toolchain
              uses: actions-rs/toolchain@v1
              with:
                  toolchain: stable
                  override: true

            - name: Build the project
              run: cargo build --verbose --all-features

            - name: Test the project
              run: cargo test --verbose

            - name: Publish the package
              run: cargo publish
              env:
                  CARGO_REGISTRY_TOKEN: ${{ secrets.CARGO_REGISTRY_TOKEN }}
